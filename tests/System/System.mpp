export module CppUtils.UnitTests.System;

import std;
import CppUtils;

export namespace CppUtils::UnitTest::System
{
	inline auto _ = TestSuite{"System", {"UnitTest"}, [](auto& suite) {
		suite.addTest("createSharedMemory", [&] {
			auto fileDescriptor = CppUtils::System::createSharedMemory();
			suite.expect(fileDescriptor.has_value());
			suite.expect(fileDescriptor.value().isValid());
		});

		suite.addTest("allocateSharedMemory", [&] {
			constexpr auto bufferSize = 1'000uz;
			auto fileDescriptor = CppUtils::System::allocateSharedMemory(bufferSize);
			suite.expect(fileDescriptor.has_value());
			suite.expect(fileDescriptor.value().isValid());
		});

		suite.addTest("mapSharedMemory", [&] {
			constexpr auto bufferSize = 1'000uz;
			auto fileDescriptor = CppUtils::System::allocateSharedMemory(bufferSize);
			auto data = CppUtils::System::mapSharedMemory(fileDescriptor.value(), bufferSize);
			suite.expect(data.has_value());
		});
	}};
}
