export module CppUtils.UnitTests.Logger;

import std;
import CppUtils;

namespace CppUtils::UnitTest::Logger
{
	auto _ = TestSuite{"Logger", {"UnitTest"}, [](TestSuite& suite) {
		using namespace std::literals;
		using Logger = TestSuite::Logger;

		suite.addTest("In console", [&] {
			Logger::print("Message");

			Logger::print<"info">("Information message");
			Logger::print<"important">("Important message");
			Logger::print<"success">("Success message");
			Logger::print<"debug">("Debug message");
			Logger::print<"detail">("Detail message");
			Logger::print<"warning">("Warning message");
			Logger::print<"error">("Error message");
		});

		suite.addTest("In file", [&] {
			CppUtils::FileSystem::TemporaryDirectory{[&suite](const auto& directory) -> void {
				const auto logPath = directory / "test.log";
				CppUtils::Log::addFileSink<"FileLogger">({.filePath = logPath});

				CppUtils::Logger<"FileLogger">::print("Message");
				CppUtils::Logger<"FileLogger">::waitUntilFinished();

				suite.expect(std::filesystem::exists(logPath));
				suite.expectEqual(CppUtils::FileSystem::String::read(logPath), "Message"s);
			}};
		});
	}};
}
