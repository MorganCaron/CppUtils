export module CppUtils.UnitTests.Language.CSV.Parsing;

import CppUtils;

namespace CppUtils::UnitTest::Language::CSV::Parsing
{
	auto _ = TestSuite{"Language/CSV/Parsing", {}, [](TestSuite& suite) {
		using namespace std::literals;
		using namespace CppUtils::Language::CSV::Literals;

		suite.addTest("_csv literal", [&] {
			const auto csv = "a;b\nc;d"_csv;

			suite.expectEqual(std::size(csv), 2uz);
			suite.expectEqual(csv[0], std::vector<std::string_view>{"a", "b"});
			suite.expectEqual(csv[1], std::vector<std::string_view>{"c", "d"});
		});

		suite.addTest("parseCSV with multiple lines and spaces", [&] {
			const auto csv = CppUtils::Language::CSV::parseCSV(R"(
			header1 ; header2 
			value1 ; value2
		)");

			suite.expectEqual(std::size(csv), 2uz);
			suite.expectEqual(csv[0], std::vector<std::string_view>{"header1", "header2"});
			suite.expectEqual(csv[1], std::vector<std::string_view>{"value1", "value2"});
		});

		suite.addTest("splitLine", [&] {
			const auto values = CppUtils::Language::CSV::splitLine(" foo ; bar ");

			suite.expectEqual(std::size(values), 2uz);
			suite.expectEqual(values[0], "foo"sv);
			suite.expectEqual(values[1], "bar"sv);
		});
	}};
}
