export module CppUtils.UnitTests.Execution.ScopeGuard;

import std;
import CppUtils;

namespace CppUtils::UnitTest::Execution::ScopeGuard
{
	auto _ = TestSuite{"Execution/ScopeGuard", {"UnitTest"}, [](auto& suite) {
		suite.addTest("Basic ScopeGuard", [&] {
			auto called = false;
			{
				auto _ = CppUtils::Execution::ScopeGuard{[&]() {
					called = true;
				}};
			}
			suite.expect(called);
		});

		suite.addTest("ScopeGuard with Exception", [&] {
			auto called = false;
			try
			{
				auto _ = CppUtils::Execution::ScopeGuard{[&]() {
					called = true;
				}};
				throw std::runtime_error("Test exception");
			}
			catch (const std::runtime_error&)
			{}
			suite.expect(called);
		});
	}};
}
