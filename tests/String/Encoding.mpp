export module CppUtils.UnitTests.String.Encoding;

import std;
import CppUtils;

export namespace CppUtils::UnitTest::String::Encoding
{
	inline auto _ = TestSuite{"String/Encoding", {"Logger"}, [](auto& suite) {
		using namespace std::literals;
		using Logger = CppUtils::Logger<"CppUtils">;

		suite.addTest("toUtf8(char32_t)", [&] {
			// 1 octet (0x00 - 0x7F)
			{
				static_assert(char32_t{0x24} == U'$');

				auto result = CppUtils::String::toUtf8(char32_t{0x24});
				Logger::print("toUtf8(0x24) -> {}\n", result);
				suite.expectEqual(result, "\x24");

				result = CppUtils::String::toUtf8(U'$');
				Logger::print("toUtf8(U'$') -> {}\n", result);
				suite.expectEqual(result, "\x24");
			}

			{
				static_assert(char32_t{0x41} == U'A');

				auto result = CppUtils::String::toUtf8(char32_t{0x41});
				Logger::print("toUtf8(0x41) -> {}\n", result);
				suite.expectEqual(result, "A");

				result = CppUtils::String::toUtf8(U'A');
				Logger::print("toUtf8(U'A') -> {}\n", result);
				suite.expectEqual(result, "A");
			}

			// 2 octet (0x80 - 0x7FF)
			{
				static_assert(char32_t{0xA2} == U'Â¢');

				auto result = CppUtils::String::toUtf8(char32_t{0xA2});
				Logger::print("toUtf8(0xA2) -> {}\n", result);
				suite.expectEqual(result, "\xC2\xA2");

				result = CppUtils::String::toUtf8(U'Â¢');
				Logger::print("toUtf8(U'Â¢') -> {}\n", result);
				suite.expectEqual(result, "\xC2\xA2");
			}

			{
				static_assert(char32_t{0x3'B1} == U'Î±');

				auto result = CppUtils::String::toUtf8(char32_t{0x3'B1});
				Logger::print("toUtf8(0x3B1) -> {}\n", result);
				suite.expectEqual(result, "\xCE\xB1");

				result = CppUtils::String::toUtf8(U'Î±');
				Logger::print("toUtf8(U'Î±') -> {}\n", result);
				suite.expectEqual(result, "\xCE\xB1");
			}

			// 3 octet (0x800 - 0xFFFF)
			{
				static_assert(char32_t{0x20'AC} == U'â‚¬');

				auto result = CppUtils::String::toUtf8(char32_t{0x20'AC});
				Logger::print("toUtf8(0x20AC) -> {}\n", result);
				suite.expectEqual(result, "\xE2\x82\xAC");

				result = CppUtils::String::toUtf8(U'â‚¬');
				Logger::print("toUtf8(U'â‚¬') -> {}\n", result);
				suite.expectEqual(result, "\xE2\x82\xAC");
			}

			{
				static_assert(char32_t{0x30'93} == U'ã‚“');

				auto result = CppUtils::String::toUtf8(char32_t{0x30'93});
				Logger::print("toUtf8(0x3093) -> {}\n", result);
				suite.expectEqual(result, "\xE3\x82\x93");

				result = CppUtils::String::toUtf8(U'ã‚“');
				Logger::print("toUtf8(U'ã‚“') -> {}\n", result);
				suite.expectEqual(result, "\xE3\x82\x93");
			}

			// 4 octet (0x10000 - 0x10FFFF)
			{
				static_assert(char32_t{0x1'03'48} == U'ðˆ');

				auto result = CppUtils::String::toUtf8(char32_t{0x1'03'48});
				Logger::print("toUtf8(0x10348) -> {}\n", result);
				suite.expectEqual(result, "\xF0\x90\x8D\x88");

				result = CppUtils::String::toUtf8(U'ðˆ');
				Logger::print("toUtf8(U'ðˆ') -> {}\n", result);
				suite.expectEqual(result, "\xF0\x90\x8D\x88");
			}

			{
				static_assert(char32_t{0x1'F6'00} == U'ðŸ˜€');

				auto result = CppUtils::String::toUtf8(char32_t{0x1'F6'00});
				Logger::print("toUtf8(0x1F600) -> {}\n", result);
				suite.expectEqual(result, "\xF0\x9F\x98\x80");

				result = CppUtils::String::toUtf8(U'ðŸ˜€');
				Logger::print("toUtf8(U'ðŸ˜€') -> {}\n", result);
				suite.expectEqual(result, "\xF0\x9F\x98\x80");
			}
		});

		suite.addTest("toUtf8(std::u32string_view)", [&] {
			// 1 octet
			{
				auto result = CppUtils::String::toUtf8(U"$"sv);
				Logger::print("toUtf8(U\"$\") -> {}\n", result);
				suite.expectEqual(result, "\x24");
			}

			{
				auto result = CppUtils::String::toUtf8(U"A"sv);
				Logger::print("toUtf8(U\"A\") -> {}\n", result);
				suite.expectEqual(result, "A");
			}

			// 2 octet
			{
				auto result = CppUtils::String::toUtf8(U"Â¢"sv);
				Logger::print("toUtf8(U\"Â¢\") -> {}\n", result);
				suite.expectEqual(result, "\xC2\xA2");
			}

			{
				auto result = CppUtils::String::toUtf8(U"Î±"sv);
				Logger::print("toUtf8(U\"Î±\") -> {}\n", result);
				suite.expectEqual(result, "\xCE\xB1");
			}

			// 3 octet
			{
				auto result = CppUtils::String::toUtf8(U"â‚¬"sv);
				Logger::print("toUtf8(U\"â‚¬\") -> {}\n", result);
				suite.expectEqual(result, "\xE2\x82\xAC");
			}

			{
				auto result = CppUtils::String::toUtf8(U"ã‚“"sv);
				Logger::print("toUtf8(U\"ã‚“\") -> {}\n", result);
				suite.expectEqual(result, "\xE3\x82\x93");
			}

			// 4 octet
			{
				auto result = CppUtils::String::toUtf8(U"ðˆ"sv);
				Logger::print("toUtf8(U\"ðˆ\") -> {}\n", result);
				suite.expectEqual(result, "\xF0\x90\x8D\x88");
			}

			{
				auto result = CppUtils::String::toUtf8(U"ðŸ˜€"sv);
				Logger::print("toUtf8(U\"ðŸ˜€\") -> {}\n", result);
				suite.expectEqual(result, "\xF0\x9F\x98\x80");
			}

			// Combined
			{
				auto result = CppUtils::String::toUtf8(U"Hello World!"sv);
				Logger::print("toUtf8(U\"Hello World!\") -> {}\n", result);
				suite.expectEqual(result, "Hello World!");
			}

			{
				auto result = CppUtils::String::toUtf8(U"$AÂ¢Î±â‚¬ã‚“ðˆðŸ˜€"sv);
				Logger::print("toUtf8(U\"$AÂ¢Î±â‚¬ã‚“ðˆðŸ˜€\") -> {}\n", result);
				suite.expectEqual(result, "$A\xC2\xA2\xCE\xB1\xE2\x82\xAC\xE3\x82\x93\xF0\x90\x8D\x88\xF0\x9F\x98\x80");
			}

			{
				auto result = CppUtils::String::toUtf8(U"Aâ‚¬ðŸ˜€"sv);
				Logger::print("toUtf8(U\"Aâ‚¬ðŸ˜€\") -> {}\n", result);
				suite.expectEqual(result, "A\xE2\x82\xAC\xF0\x9F\x98\x80");
			}
		});
	}};
}
